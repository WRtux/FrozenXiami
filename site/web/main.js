"use strict";var H={buildHexadecimal(e,t){return e=Number.parseInt(e),Number.isNaN(e)?null:"0x"+e.toString(16).padStart(t,"0").toUpperCase()},filterFunction(e){return"function"==typeof e?e:null},filterGetFunction(e){return"function"==typeof e?e:()=>{}},readFileP(n){return new Promise(function(t,r){let e=new FileReader;e.readAsArrayBuffer(n),e.addEventListener("load",e=>{t(e.target.result)}),e.addEventListener("error",e=>{r()})})},restP(){return new Promise((e,t)=>{window.setTimeout(e,0)})},buildElement(e,t,r){let n=document.createElement(e);for(var l in t)n.setAttribute(l,t[l]);return null!=r&&(n.textContent=r),n},buildInfoRow(e,t){let r=document.createDocumentFragment();r.appendChild(this.buildElement("dt",null,e));for(var n of null!=t?t:"")r.appendChild(this.buildElement("dd",null,n));return r},replaceChildrenClass(e,t,r){for(var n of e.getElementsByClassName(t))n.classList.replace(t,r)},removeChildren(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}};"use strict";var page={main:document.getElementById("main"),masks:{toast:document.getElementById("mask-toast"),dialog:document.getElementById("mask-dialog")},templates:{main:document.getElementById("main-template").content,toast:document.getElementById("toast-template").content,dialog:document.getElementById("dialog-template").content}};function toast(e,t){let n=document.importNode(page.templates.toast.firstElementChild,!0);return n.addEventListener("click",e=>{clearToast(n)}),n.firstElementChild.textContent=e,page.masks.toast.appendChild(n),window.setTimeout(()=>{clearToast(n)},null!=t?t:2e3),n}function clearToast(e){e.classList.add("toast-clear"),window.setTimeout(()=>{null!=e.parentElement&&e.remove()},300)}function openDialog(e){let t=document.getElementById("dialog-"+e),n;return null!=t?n=t.parentElement:(n=document.importNode(page.templates.dialog.firstElementChild,!0),t=n.firstElementChild,n.classList.add("block-dynamic"),t.id="dialog-"+e),n.classList.add("block-active"),t.querySelector(".dialog> .dialog-close").addEventListener("click",e=>{closeDialog(t)}),page.masks.dialog.appendChild(n),t}function alertDialog(e,t,n){let l=openDialog(Math.floor(Math.random()*36**5).toString(36).padStart(5,"0"));return l.querySelector(".dialog> h2").textContent=null!=e?e:"提示",l.querySelector(".dialog> p").textContent=t,n&&l.querySelector(".dialog> .dialog-close").remove(),l}function updateDialog(e,t){null!=(e=e instanceof Element?e:document.getElementById("dialog-"+e))&&null!=t&&(e.querySelector(".dialog> p").textContent=t)}function closeDialog(t){if(null!=(t=t instanceof Element?t:document.getElementById("dialog-"+t))){let e=t.parentElement;e.classList.contains("block-dynamic")?e.remove():e.classList.remove("block-active")}return t}!function(){let e=document.getElementsByTagName("template");for(;0<e.length;)e[0].remove();document.getElementById("nav-search").addEventListener("click",e=>{openDialog("search")}),document.getElementById("nav-file").addEventListener("click",e=>{openDialog("file")}),document.getElementById("dialog-file-pool").addEventListener("change",function(e){if(1==this.files.length)return void alertDialog("不可用","读取功能未被实现。")}),navigator.userAgent.match(/\b(?:Mobile|[Aa]ndroid|iPhone|iPad)\b/)&&toast("正在使用移动设备访问，加载可能会较缓慢或导致内存不足。",3e3)}();"use strict";var scene={current:"load",list:new Object,helper:new Object,activateMenu:function(n,t){if(null!=n){let e=document.querySelector("#nav> .nav-item.block-active");null!=e&&e.classList.remove("block-active"),e=document.querySelectorAll("#nav> .nav-item")[n],null!=e&&e.classList.add("block-active")}if(null!=t){let n=page.main.querySelector(".main-sidebar .main-menu");if(null!=n){let e=n.getElementsByClassName("block-active")[0];null!=e&&e.classList.remove("block-active"),e=n.children[t],null!=e&&e.classList.add("block-active")}}},switch:function(e){let n=this.list[e];var t=n&&n.createMain(page.templates.main);return null==t?null:(H.removeChildren(page.main),page.main.appendChild(t),this.activateMenu(...n.menuConfig),this.current=e,t)},display:function(e){let n=this.list[this.current];return n&&H.filterFunction(n.display)?Promise.resolve(n.display(page.main.children,e)):null}};scene.list.home={menuConfig:[0,0],createMain:function(e){let n=document.createDocumentFragment();n.appendChild(document.importNode(e.getElementById("main-navbar"),!0)),n.appendChild(document.importNode(e.getElementById("main-home"),!0));let t=n.children[0].getElementsByClassName("main-menu")[0];return t.children[0].addEventListener("click",e=>{scene.switch("home")}),t.children[1].addEventListener("click",e=>{scene.switch("home-playlists")}),t.children[2].addEventListener("click",e=>{scene.switch("home-artists")}),t.children[3].addEventListener("click",e=>{scene.switch("home-albums")}),t.children[4].addEventListener("click",e=>{scene.switch("home-styles")}),t.children[6].addEventListener("click",e=>{scene.switch("about")}),n},display:null},scene.list["home-playlists"]=scene.list["home-artists"]=scene.list["home-albums"]=scene.list["home-styles"]={createMain:function(e){return toast("页面尚未实现，请等待后续版本。"),null}},scene.list.user={createMain:function(e){return toast("页面尚未实现，请等待后续版本。"),null}},scene.list.retrieval={createMain:function(e){return toast("页面尚未实现，请等待后续版本。"),null}},scene.list.artist={menuConfig:[null,-1],createMain:function(e){let n=document.createDocumentFragment();return n.appendChild(document.importNode(e.getElementById("main-listbar"),!0)),n.appendChild(document.importNode(e.getElementById("main-list"),!0)),H.replaceChildrenClass(n.children[0],"main-cover-list","main-cover-artist"),n.children[1].getElementsByClassName("main-user")[0].remove(),n},display:function(e,n){let t=e[0].getElementsByClassName("main-cover-artist")[0];H.removeChildren(t),t.appendChild(H.buildElement("img",{src:n.logoURL})),t=e[0].getElementsByClassName("block-content")[0],t.children[0].textContent="艺人介绍",t.children[1].textContent=null!=n.info?n.info:"",e[1].getElementsByClassName("main-title")[0].textContent=n.name,t=e[1].getElementsByClassName("main-infolist")[0],H.removeChildren(t),n.gender&&t.appendChild(H.buildInfoRow("性别",[n.gender])),n.birthday&&t.appendChild(H.buildInfoRow("生日",[n.birthday])),n.area&&t.appendChild(H.buildInfoRow("地区",[n.area]))}},scene.list.album={menuConfig:[null,-1],createMain:function(e){let n=document.createDocumentFragment();return n.appendChild(document.importNode(e.getElementById("main-listbar"),!0)),n.appendChild(document.importNode(e.getElementById("main-list"),!0)),H.replaceChildrenClass(n.children[0],"main-cover-list","main-cover-album"),n},display:async function(e,n){let t=e[0].getElementsByClassName("main-cover-album")[0];H.removeChildren(t),t.appendChild(H.buildElement("img",{src:n.logoURL})),t.appendChild(H.buildElement("span",{class:"icon-play"},n.playCount)),t=e[0].getElementsByClassName("block-content")[0],t.children[0].textContent="专辑介绍",t.children[1].textContent=null!=n.info?n.info:"",e[1].getElementsByClassName("main-title")[0].textContent=n.name,t=e[1].getElementsByClassName("main-user")[0],H.removeChildren(t);for(var l of null!=n.artists?n.artists:""){l=await queryEntryP("artist",l.id,l.sid);t.appendChild(H.buildElement("img",{src:l.logoURL})),t.appendChild(H.buildElement("span",null,l.name))}t=e[1].getElementsByClassName("main-infolist")[0],H.removeChildren(t),n.discCount&&t.appendChild(H.buildInfoRow("碟片数",[n.discCount])),n.songCount&&t.appendChild(H.buildInfoRow("曲目数",[n.songCount])),n.publishTime&&t.appendChild(H.buildInfoRow("发行时间",[n.publishTime])),n.language&&t.appendChild(H.buildInfoRow("语言",[n.language]))}},scene.list.song={menuConfig:[null,-1],createMain:function(e){let n=document.createDocumentFragment();return n.appendChild(document.importNode(e.getElementById("main-songbar"),!0)),n.appendChild(document.importNode(e.getElementById("main-song"),!0)),n},display:async function(e,n){var t=await queryEntryP("album",n.album.id,n.album.sid);let l=e[0].getElementsByClassName("main-cover-song")[0];H.removeChildren(l),l.appendChild(H.buildElement("img",{src:t.logoURL})),l.appendChild(H.buildElement("span",{class:"icon-play"},n.playCount)),l=e[0].getElementsByClassName("main-infolist")[0],H.removeChildren(l),l.appendChild(H.buildInfoRow("专辑",[n.album.name])),e[1].getElementsByClassName("main-title")[0].textContent=n.name,t=await queryEntryP("artist",n.artist.id,n.artist.sid),l=e[1].getElementsByClassName("main-user")[0],H.removeChildren(l),l.appendChild(H.buildElement("img",{src:t.logoURL})),l.appendChild(H.buildElement("span",null,t.name)),l=e[1].getElementsByClassName("main-infolist")[0],H.removeChildren(l),n.translation&&l.appendChild(H.buildInfoRow("译名",[n.translation])),n.disc&&l.appendChild(H.buildInfoRow("碟片 #",[n.disc])),n.track&&l.appendChild(H.buildInfoRow("曲目 #",[n.track]))}},scene.list.playlist={createMain:function(e){return toast("页面尚未实现，请等待后续版本。"),null}},scene.list.about={createMain:function(e){return toast("页面尚未实现，请等待后续版本。"),null}};